{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["'use strict'\n\n/**\n * Module dependencies\n */\n\n// Public node modules.\nimport type { ReadStream } from 'node:fs'\nimport { join } from 'path'\nimport { type IPFSHTTPClient, create, type Options, type CID } from 'kubo-rpc-client'\n\nexport interface File {\n  name: string\n  alternativeText?: string\n  caption?: string\n  width?: number\n  height?: number\n  formats?: Record<string, unknown>\n  hash: string\n  ext?: string\n  mime: string\n  size: number\n  sizeInBytes: number\n  url: string\n  previewUrl?: string\n  path?: string\n  provider?: string\n  provider_metadata?: Record<string, unknown>\n  stream?: ReadStream\n  buffer?: Buffer\n}\n\nlet client: IPFSHTTPClient\n\nexport interface InitOptions {\n  clientOptions?: Options\n  gatewayUrl?: string\n}\n\nexport default {\n  init ({ gatewayUrl, clientOptions }: InitOptions) {\n    client = create(clientOptions)\n\n    const upload = async (file: File): Promise<void> => {\n      const ipfsStatus = await client.add({\n        path: file.name,\n        content: file.stream ?? file.buffer\n      })\n      console.log('IPFS Status', ipfsStatus)\n      file.url = join(String(gatewayUrl), String(ipfsStatus.cid))\n    }\n\n    return {\n      async uploadStream (file: File) {\n        await upload(file)\n      },\n      async upload (file: File) {\n        await upload(file)\n      },\n      async delete (file: File) {\n        const command = async (file: File): Promise<CID> => {\n          if (file.path === undefined) {\n            throw Error('No file given.')\n          }\n          return await client.pin.rm(file.path)\n        }\n        await command(file)\n      }\n    }\n  }\n}\n"],"names":["create","join","file"],"mappings":";;;AAgCA,IAAI;AAOJ,MAAe,QAAA;AAAA,EACb,KAAM,EAAE,YAAY,iBAA8B;AAChD,aAASA,cAAAA,OAAO,aAAa;AAEvB,UAAA,SAAS,OAAO,SAA8B;AAC5C,YAAA,aAAa,MAAM,OAAO,IAAI;AAAA,QAClC,MAAM,KAAK;AAAA,QACX,SAAS,KAAK,UAAU,KAAK;AAAA,MAAA,CAC9B;AACO,cAAA,IAAI,eAAe,UAAU;AAChC,WAAA,MAAMC,UAAK,OAAO,UAAU,GAAG,OAAO,WAAW,GAAG,CAAC;AAAA,IAAA;AAGrD,WAAA;AAAA,MACL,MAAM,aAAc,MAAY;AAC9B,cAAM,OAAO,IAAI;AAAA,MACnB;AAAA,MACA,MAAM,OAAQ,MAAY;AACxB,cAAM,OAAO,IAAI;AAAA,MACnB;AAAA,MACA,MAAM,OAAQ,MAAY;AAClB,cAAA,UAAU,OAAOC,UAA6B;AAC9CA,cAAAA,MAAK,SAAS,QAAW;AAC3B,kBAAM,MAAM,gBAAgB;AAAA,UAC9B;AACA,iBAAO,MAAM,OAAO,IAAI,GAAGA,MAAK,IAAI;AAAA,QAAA;AAEtC,cAAM,QAAQ,IAAI;AAAA,MACpB;AAAA,IAAA;AAAA,EAEJ;AACF;;"}